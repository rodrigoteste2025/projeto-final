
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema IDAF – Cadastros Agropecuários</title>

<!-- Bibliotecas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

<style>
body{font-family:Arial;background:#f4f6f8;margin:0}
header{background:#0d47a1;color:#fff;padding:15px;text-align:center}
.container{padding:20px}
.card{background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.2);margin-bottom:20px}
label{font-weight:bold;display:block;margin-top:10px}
input,textarea{width:100%;padding:8px;margin-top:5px}
button{padding:10px;margin-top:15px;border:none;border-radius:5px;cursor:pointer}
.btn{background:#1976d2;color:#fff}
.btn-danger{background:#d32f2f;color:#fff}
.btn-edit{background:#f9a825}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
th{background:#1976d2;color:#fff}
.vencido{background:#ffcdd2}
.prazo{background:#c8e6c9}

/* LOGIN MODAL */
#loginModal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:9999}
#loginBox{background:#fff;padding:30px;border-radius:8px;width:300px;text-align:center}
</style>
</head>
<body>

<header>
<h2>Sistema de Acompanhamento de Cadastros Agropecuários – IDAF</h2>
</header>

<!-- LOGIN OBRIGATÓRIO -->
<div id="loginModal">
  <div id="loginBox">
    <h3>Acesso ao Sistema</h3>
    <input id="loginUsuario" placeholder="USUÁRIO" oninput="this.value=this.value.toUpperCase()">
    <input id="loginSenha" type="password" placeholder="SENHA">
    <button class="btn" id="btnLogin">Entrar</button>
  </div>
</div>

<div class="container">

<div class="card">
<h3>Novo Cadastro</h3>
<form id="formCadastro">
<label>Nome da Propriedade</label>
<input id="propriedade" required oninput="this.value=this.value.toUpperCase()">

<label>Nome Completo</label>
<input id="nome" required oninput="this.value=this.value.toUpperCase()">

<label>Apelido</label>
<input id="apelido" oninput="this.value=this.value.toUpperCase()">

<label>Endereço</label>
<input id="endereco" required oninput="this.value=this.value.toUpperCase()">

<label>Telefone</label>
<input id="telefone" required>

<label>Data de Abertura</label>
<input id="data" type="date" required>

<label>Observações</label>
<textarea id="obs" oninput="this.value=this.value.toUpperCase()"></textarea>

<button class="btn" type="submit">Salvar</button>
</form>
</div>

<div class="card">
<h3>Cadastros</h3>
<table>
<thead>
<tr>
<th>Propriedade</th><th>Nome</th><th>Endereço</th><th>Telefone</th><th>Data</th><th>Dias</th><th>Status</th><th>Usuário</th><th>Obs</th><th>Ações</th>
</tr>
</thead>
<tbody id="tabela"></tbody>
</table>

<button class="btn" onclick="baixarExcel()">Baixar Excel</button>
<button class="btn" onclick="baixarPDF()">Baixar PDF</button>
</div>

</div>

<script>
/***** LOGIN – USUÁRIOS FIXOS *****/
const usuarios = {
  RODRIGO:'1234',
  JANIEL:'1234',
  CASSIA:'1234',
  MARCOS:'1234',
  RAIMUNDA:'1234'
};

let usuarioAtual = null;

function iniciarLogin(){
  document.getElementById('loginModal').style.display='flex';
}

function validarLogin(){
  const u=document.getElementById('loginUsuario').value.toUpperCase();
  const s=document.getElementById('loginSenha').value;
  if(!usuarios[u] || usuarios[u]!==s){
    alert('Usuário ou senha inválidos');
    return;
  }
  usuarioAtual=u;
  document.getElementById('loginModal').style.display='none';
}

document.getElementById('btnLogin').addEventListener('click',validarLogin);
window.onload=iniciarLogin;

/***** DADOS *****/
let cadastros=[];
let editIndex=null;

function diasDiff(d){return Math.floor((new Date()-new Date(d))/(1000*60*60*24));}

function render(){
 tabela.innerHTML='';
 cadastros.forEach((c,i)=>{
  const dias=diasDiff(c.data);
  const cls=dias>60?'vencido':'prazo';
  const status=dias>60?'VENCIDO':'NO PRAZO';
  tabela.innerHTML+=`<tr class="${cls}">
   <td>${c.prop}</td><td>${c.nome}</td><td>${c.end}</td><td>${c.tel}</td><td>${c.data}</td><td>${dias}</td><td>${status}</td><td>${c.user}</td><td>${c.obs}</td>
   <td><button class="btn-edit" onclick="editar(${i})">Editar</button> <button class="btn-danger" onclick="excluir(${i})">Excluir</button></td>
  </tr>`;
 });
}

formCadastro.onsubmit=e=>{
 e.preventDefault();
 if(!usuarioAtual){alert('Faça login');return;}
 const obj={
  prop:propriedade.value,
  nome:nome.value,
  end:endereco.value,
  tel:telefone.value,
  data:data.value,
  obs:obs.value,
  user:usuarioAtual
 };
 if(editIndex===null) cadastros.push(obj); else cadastros[editIndex]=obj;
 editIndex=null;
 formCadastro.reset();
 render();
};

function editar(i){const c=cadastros[i];propriedade.value=c.prop;nome.value=c.nome;endereco.value=c.end;telefone.value=c.tel;data.value=c.data;obs.value=c.obs;editIndex=i;}
function excluir(i){if(confirm('Excluir?')){cadastros.splice(i,1);render();}}

function baixarExcel(){const ws=XLSX.utils.json_to_sheet(cadastros);ws['!cols']=Array(8).fill({wch:25});const wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,'Relatório');XLSX.writeFile(wb,'relatorio_idaf.xlsx');}

function baixarPDF(){const{jsPDF}=window.jspdf;const doc=new jsPDF('landscape');doc.text('Relatório IDAF',14,15);doc.autoTable({head:[['PROPRIEDADE','NOME','ENDEREÇO','TELEFONE','DATA','DIAS','STATUS','USUÁRIO','OBS']],body:cadastros.map(c=>[c.prop,c.nome,c.end,c.tel,c.data,diasDiff(c.data),diasDiff(c.data)>60?'VENCIDO':'NO PRAZO',c.user,c.obs]),startY:25,theme:'grid'});doc.save('relatorio_idaf.pdf');}
</script>

<footer style="text-align:center;padding:15px;font-size:12px">Todos os direitos reservados © IDAF</footer>

</body>
</html>

